window.Ajax=function(){function fn(){}function request(url,opt){var methed=opt.methed.toUpperCase()||"GET",data=opt.data||null,asyn=opt.asyn||true,timeout=opt.timeout||0,success=opt.success||fn,failure=opt.failure||fn;var time=new Date().getTime(),isTimeout=false,timer=null;if(typeof data=="object"){var str="";for(var key in data){str+=key+"="+data[key]+"&"}data=str.slice(0,str.length-1)}if(methed=="GET"){if(data){url+=(data.indexOf("?")==-1?"?":"&")+data;url+="&t="+time;data=null}else{url+="t="+time}}var xhr=function(){try{return new XMLHttpRequest()}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){failure(null,"create xhr failed",e)}}}();if(timeout>0){timer=setTimeout(function(){isTimeout=true;xhr.abort()},timeout)}xhr.onreadystatechange=function(){if(xhr.readyState==4&&!isTimeout){_onreadystatechange(xhr,success,failure);clearTimeout(timer)}};xhr.open(methed,url,asyn);if(methed=="POST"){xhr.setRequestHeader("Content-length",data.length);xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded;")}xhr.send(data);return xhr}function _onreadystatechange(xhr,success,failure){if(xhr.status>=200&&xhr.status<300){success(xhr)}else{failure(xhr)}}return{request:request}}();